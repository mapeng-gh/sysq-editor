<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >  
<mapper namespace="mapper.TaskMapper">
    
        <sql id="allColumns">
            id,user_id,interview_id,create_time,update_time
        </sql>
	
	<resultMap id="allResultMap" type="Task">
		<id column="id" property="id" jdbcType="INTEGER" javaType="_int"/>
		<result column="user_id" property="userId" jdbcType="INTEGER" javaType="_int"/>
		<result column="interview_id" property="interviewId" jdbcType="INTEGER" javaType="_int"/>
		<result column="create_time" property="createTime" jdbcType="TIMESTAMP" javaType="date" />
		<result column="update_time" property="updateTime" jdbcType="TIMESTAMP" javaType="date" />
	</resultMap>
	
        <insert id="insert" parameterType="Task" useGeneratedKeys="true" keyProperty="id">
            insert into editor_task(user_id,interview_id,create_time,update_time) 
            values(#{userId},#{interviewId},#{createTime},#{updateTime})
        </insert>
        
        <select id="findAllTaskPage" parameterType="hashmap" resultMap="allResultMap">
            select task.id,task.user_id,task.interview_id,task.create_time,task.update_time 
	    from editor_task task 
	    inner join editor_user usr on task.user_id = usr.id 
	    <trim prefix="where" prefixOverrides="and">
                   <if test="name != null and name != ''">and usr.name like concat(concat('%',#{name}),'%')</if>
            </trim>
            order by task.create_time desc 
            limit #{offset},#{limit}
        </select>
        
        <select id="countAllTask" parameterType="hashmap" resultType="_int">
            select count(task.id)
	    from editor_task task 
	    inner join editor_user usr on task.user_id = usr.id 
	    <trim prefix="where" prefixOverrides="and">
                   <if test="name != null and name != ''">and usr.name like concat(concat('%',#{name}),'%')</if>
            </trim>
        </select>
        
        <select id="findUserTaskPage" parameterType="hashmap" resultMap="allResultMap">
            select task.id,task.user_id,task.interview_id,task.create_time,task.update_time 
	    from editor_task task 
	    inner join editor_user usr on task.user_id = usr.id 
	    inner join sysq_interview interview on task.interview_id = interview.id 
	    inner join sysq_patient patient on interview.patient_id = patient.id 
	    where task.user_id = #{userId} 
	    <if test="name != null and name != ''">and patient.username like concat(concat('%',#{name}),'%')</if>
            order by task.create_time desc 
            limit #{offset},#{limit}
        </select>
        
        <select id="countUserTask" parameterType="hashmap" resultType="_int">
            select count(task.id)
	    from editor_task task 
	    inner join editor_user usr on task.user_id = usr.id 
	    inner join sysq_interview interview on task.interview_id = interview.id 
	    inner join sysq_patient patient on interview.patient_id = patient.id 
	    where task.user_id = #{userId} 
	    <if test="name != null and name != ''">and patient.username like concat(concat('%',#{name}),'%')</if>
        </select>
        
        <select id="findByInterviewId" parameterType="_int" resultMap="allResultMap">
            select <include refid="allColumns"></include> 
            from editor_task 
            where interview_id = #{interviewId}
        </select>
        
</mapper>  